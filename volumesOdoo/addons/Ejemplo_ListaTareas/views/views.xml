<!-- Declaración del archivo XML principal de vistas -->
<odoo>
  <data>

    <!-- ==================================================
         ACCIÓN PRINCIPAL DEL MÓDULO
         ===================================================
         Esta acción es la que se ejecutará cuando el usuario
         entre en el menú "Ver tareas".
         Abre el modelo lista_tareas.lista mostrando sus vistas.
    -->
    <record model="ir.actions.act_window" id="action_lista_tareas">
      <!-- Título visible de la ventana -->
      <field name="name">Listado de tareas</field>

      <!-- Modelo al que se refiere la acción -->
      <field name="res_model">lista_tareas.lista</field>

      <!-- Tipo de vistas que se mostrarán:
           list → vista en tabla
           form → vista en formulario -->
      <field name="view_mode">list,form</field>
    </record>


<!--      ACCION PARA KANBAN-->
      <record model="ir.actions.act_window" id="action_lista_tareas_kanban">
      <!-- Título visible de la ventana -->
      <field name="name">Listado de tareas kanban</field>

      <!-- Modelo al que se refiere la acción -->
      <field name="res_model">lista_tareas.lista</field>

      <!-- Tipo de vistas que se mostrarán:
           list → vista en tabla
           form → vista en formulario
           kanban → vista en kanban-->
      <field name="view_mode">kanban,list,form</field>
    </record>


      <!--      ACCION PARA CALENDARIOOO-->
      <record model="ir.actions.act_window" id="action_lista_tareas_calendario">
      <!-- Título visible de la ventana -->
      <field name="name">Listado de tareas calendario</field>

      <!-- Modelo al que se refiere la acción -->
      <field name="res_model">lista_tareas.lista</field>

      <!-- Tipo de vistas que se mostrarán:
           list → vista en tabla
           form → vista en formulario
           calendar → vista en calendario-->
      <field name="view_mode">calendar,list,form</field>
    </record>

    <!-- ==================================================
         MENÚS DEL MÓDULO
         ===================================================
         Creamos la estructura jerárquica de menús en Odoo.
         Esto permite al usuario acceder a las vistas.
    -->

    <!-- Menú raíz que aparece en la barra superior -->
    <menuitem id="lista_tareas_menu_root" name="Listado de tareas" sequence="10"/>

    <!-- Submenú dentro del menú raíz.
         Permite agrupar más opciones si lo necesitas en el futuro. -->
    <menuitem id="lista_tareas_menu_1" name="Gestión de tareas"
              parent="lista_tareas_menu_root" sequence="20"/>

    <!-- Opción final de menú que ejecuta la acción definida arriba.
         Abre la interfaz con lista y formulario de tareas. -->
    <menuitem id="lista_tareas_menu_1_list" name="Ver tareas"
              parent="lista_tareas_menu_1" action="action_lista_tareas" sequence="30"/>

<!--      kanbannnnn-->
      <menuitem id="lista_tareas_menu_1_kanban" name="Ver kanban"
              parent="lista_tareas_menu_1" action="action_lista_tareas_kanban" sequence="40"/>

<!--      calendariooo-->
      <menuitem id="lista_tareas_menu_1_calendario" name="Ver calendario"
              parent="lista_tareas_menu_1" action="action_lista_tareas_calendario" sequence="50"/>


    <!-- ==================================================
         VISTA DE LISTA (list)
         ===================================================
         Muestra las tareas en forma de tabla.
         Es la vista que se usa por defecto para ver varios registros.
    -->
    <record id="view_lista_tareas_list" model="ir.ui.view">
      <!-- Nombre interno de la vista -->
      <field name="name">lista.tareas.list</field>

      <!-- Modelo al que pertenece esta vista -->
      <field name="model">lista_tareas.lista</field>

      <!-- Estructura XML de la vista -->
      <field name="arch" type="xml">
        <!-- Vista tipo list (reemplaza a <tree> en Odoo 17+) -->
        <tree string="Tareas" default_order="prioridad desc">
          <!-- Campos que se muestran como columnas -->
          <field name="tarea"/>         <!-- Nombre de la tarea -->
          <field name="prioridad"/>     <!-- Nivel de prioridad -->
          <field name="fecha"/>         <!-- Fecha limite -->
          <field name="urgente"/>       <!-- Calculado automáticamente -->
          <field name="realizada"/>     <!-- Estado de finalización -->
        </tree>
      </field>
    </record>

    <!-- ==================================================
         VISTA DE FORMULARIO (form)
         ===================================================
         Se usa al crear o editar una tarea.
         Más amigable y detallada que la vista de lista.
    -->
    <record id="view_lista_tareas_form" model="ir.ui.view">
      <field name="name">lista.tareas.form</field>
      <field name="model">lista_tareas.lista</field>
      <field name="arch" type="xml">
        <form string="Tarea">
          <!-- El contenedor visual principal del formulario -->
          <sheet>
            <!-- Primer bloque de campos (agrupados) -->
            <group>
              <field name="tarea"/>         <!-- Campo de nombre de tarea -->
              <field name="realizada"/>     <!-- Campo para marcar como realizada -->
            </group>

            <!-- Segundo bloque de campos (prioridad y urgencia) -->
            <group string="Prioridad, fecha y urgencia">
              <field name="prioridad"/>     <!-- Campo de prioridad editable -->
                <field name="fecha"/>
              <!-- Campo calculado: no editable. Ya no usamos attrs (Odoo 17+) -->
              <field name="urgente" readonly="1"/>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <!-- ==================================================
         VISTA DE BÚSQUEDA (search)
         ===================================================
         Aparece como la barra superior de búsqueda en la vista de lista.
         Permite buscar y filtrar tareas por varios criterios.
    -->
    <record id="view_lista_tareas_search" model="ir.ui.view">
      <field name="name">lista.tareas.search</field>
      <field name="model">lista_tareas.lista</field>
      <field name="arch" type="xml">
        <search string="Buscar tareas">

          <!-- Campo de búsqueda libre -->
          <field name="tarea"/>

          <!-- Filtros predefinidos -->
          <filter name="filtro_urgente" string="Urgente"
                  domain="[('urgente','=',True)]"/>

          <filter name="filtro_realizada" string="Realizadas"
                  domain="[('realizada','=',True)]"/>
        </search>
      </field>
    </record>


<!--      VISTA DE CALENDARIO CON FECHA LIMITE ??-->
    <record model="ir.ui.view" id="lista_tareas_calendar">
    <field name="name">lista tareas calendar</field>
    <field name="model">lista_tareas.lista</field>
    <field name="arch" type="xml">
        <calendar string="Tareas Calendar" date_start="fecha"
           color="urgente"> <!-- El color indica el field que lo modifica
                        No un color literalmente -->
            <field name="tarea"/>
        </calendar>
    </field>
</record>





<!--      VISTA KANBAN -->
<record model="ir.ui.view" id="lista_tareas_kanban_view">
    <field name="name">Lista tareas kanban</field>
    <field name="model">lista_tareas.lista</field>
    <field name="arch" type="xml">
        <kanban>
            <!-- Estos fields se cargan inicialmente y pueden ser utilizados
            por la lógica del Kanban -->
            <field name="tarea" />
            <field name="prioridad" />
            <field name="fecha" />
            <field name="urgente" />
            <field name="realizada" />
            <field name="id" /> <!-- Es importante añadir el id para el
            record.id.value posterior -->

            <templates>
                <t t-name="kanban-box">
                    <div class="oe_product_vignette">
                        <!-- Aprovechando un CSS de products -->
                        <a type="open">
                            <h4 t-att-alt="record.tarea.value">
                                <t t-esc="record.tarea.value"/>
                            </h4>
                        </a>

                        <!-- record es una variable que tiene QWeb para acceder a las
                             propiedades del registro que estamos mostrando. Las propiedades
                             accesibles son las que hemos puesto en los fields de arriba. -->
                        <div class="oe_product_desc">
                            <div>
                                <b>Prioridad:</b>
                                <span t-esc="record.prioridad.value"/>
                            </div>

                            <div>
                                <b>Urgente:</b>
                                <span t-esc="record.urgente.value and 'Sí' or 'No'"/>
                            </div>

                            <div>
                                <b>Realizada:</b>
                                <span t-esc="record.realizada.value and 'Sí' or 'No'"/>
                            </div>

                            <h4>
                                <a type="edit"> <!-- Abre un formulario de edición -->
                                    <field name="id"></field>
                                    <field name="tarea"></field>
                                </a>
                            </h4>

                        </div>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>




  </data>
</odoo>
